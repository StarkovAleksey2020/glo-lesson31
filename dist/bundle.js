(()=>{"use strict";function t(t,e,i){"default"===i.cityOutputMode||"select"===i.cityOutputMode?i.fillCountryList(t):i.fillCountryList(i.citiesBuf,e)}function e(){document.querySelectorAll(".dropdown-lists__list").forEach((function(t){t.querySelector(".dropdown-lists__col").innerHTML=""}))}function i(t,e){return+e.count-+t.count}function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var s=document.getElementById("select-cities"),n=document.querySelector(".close-button"),c=document.querySelector(".label"),l=document.querySelector(".button"),r=(document.querySelectorAll(".dropdown-lists__col"),document.querySelectorAll(".dropdown-lists__total-line"),document.querySelectorAll(".dropdown-lists__list"),document.querySelector(".dropdown-lists__list--default")),a=document.querySelector(".dropdown-lists__list--select"),d=document.querySelector(".dropdown-lists__list--autocomplete"),u=(document.querySelector(".main"),document.querySelector(".dropdown")),y=new(function(){function y(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y),this.citiesArray={},this.cityClicked=!1,this.cityClickedIndex=void 0,this.cityOutputMode="default",this.searchCity="",this.citiesBuf=[],this.local=""}var p,f;return p=y,(f=[{key:"getCitiesFromStorage",value:function(){return localStorage.getItem("cities")?JSON.parse(localStorage.getItem("cities")):[]}},{key:"getCityBD",value:function(e,i,o,s){var n=this;this.citiesBuf=[];var c,r,a,d,u,y=document.createElement("div");y.style.cssText="font-size: 2rem",y.style.color="#FFFFFF",y.style.marginTop="30px",y.classList.add("loader"),l.appendChild(y),this.citiesArray=this.getCitiesFromStorage(),void 0===this.citiesArray||0===this.citiesArray.length?fetch("./db_cities.json",{mode:"cors"}).then((function(t){if(200!==t.status)throw new Error("Status: ".concat(t.statusText,". Code: ").concat(t.status,"."));return t.json()})).then((function(e){localStorage.setItem("cities",JSON.stringify(e)),n.citiesArray=e[s],setTimeout((function(){y.classList.remove("loader")}),100),n.citiesArray=n.fillCitiesArray(n.citiesArray,o),t(n.citiesArray,o,n)})):(this.citiesArray=this.citiesArray[this.local],this.citiesArray=(c=this.citiesArray,r=this.local,a={RU:[{country:["РОССИЯ","RUSSIA","RUSSLAND"]}],DE:[{country:["ГЕРМАНИЯ","GERMANY","DEUTSCHLAND"]}],EN:[{country:["АНГЛИЯ","UNITED KINGDOM","ENGLAND"]}]}[r][0].country,d=c.filter((function(t){if(a.includes(t.country.toUpperCase()))return!0})),u=d[0].country.toUpperCase(),c.forEach((function(t){t.country.toUpperCase()!==u&&d.push(t)})),d),setTimeout((function(){y.classList.remove("loader")}),100),this.citiesArray=this.fillCitiesArray(this.citiesArray,o),t(this.citiesArray,o,this))}},{key:"fillCitiesArray",value:function(t,e){var o=this;return t.forEach((function(t,s){t.cities.sort(i);for(var n=[],c=0;c<t.cities.length;c++)"default"===o.cityOutputMode||"select"===o.cityOutputMode&&s!==o.cityClickedIndex?c<3&&n.push(t.cities[c]):"select"===o.cityOutputMode&&s===o.cityClickedIndex?n.push(t.cities[c]):"autocomplete"===o.cityOutputMode&&e.length>0&&-1!==t.cities[c].name.toLowerCase().indexOf(e)&&o.citiesBuf.push(t.cities[c]);t.cities=n})),t}},{key:"fillCountryList",value:function(t,i){var o=this;e();var y="";"default"===this.cityOutputMode?(y=document.querySelector(".dropdown-lists__list--default").querySelector(".dropdown-lists__col"),r.style.display="block",a.style.display="none",d.style.display="none"):"select"===this.cityOutputMode?(y=document.querySelector(".dropdown-lists__list--select").querySelector(".dropdown-lists__col"),r.style.display="none",d.style.display="none",a.style.display="block"):"autocomplete"===this.cityOutputMode&&(y=document.querySelector(".dropdown-lists__list--autocomplete").querySelector(".dropdown-lists__col"),r.style.display="none",a.style.display="none",d.style.display="block"),"default"===this.cityOutputMode||"select"===this.cityOutputMode?t.forEach((function(e,i,s){for(var n='<div class="dropdown-lists__countryBlock">\n                        <div class="dropdown-lists__total-line">\n                            <div class="dropdown-lists__country">'.concat(e.country,'</div>\n                            <div class="dropdown-lists__count">').concat(e.count,"</div>\n                        </div>"),c=0;c<t[i].cities.length;c++)n+='<div class="dropdown-lists__line" data-url="'.concat(t[i].cities[c].link,'">\n                        <div class="dropdown-lists__city" data-url="').concat(t[i].cities[c].link,'">\n                        ').concat(t[i].cities[c].name,'</div>\n                        <div class="dropdown-lists__count" data-url="').concat(t[i].cities[c].link,'">\n                        ').concat(t[i].cities[c].count,"</div>\n                    </div>");n+="</div>",u.style.position="absolute","default"===o.cityOutputMode?u.style.left="-40px":"select"===o.cityOutputMode&&(u.style.left="40px"),u.style.opacity=0,y.insertAdjacentHTML("beforeend",n);var l=0,r=setInterval((function(){if(40===l)return clearInterval(r),void(u.style.position="relative");a(l),l++}),5),a=function(t){"default"===o.cityOutputMode?u.style.transform="translateX(".concat(t,"px)"):"select"===o.cityOutputMode&&(u.style.transform="translateX(-".concat(t,"px)")),u.style.opacity=t/40},d=y.querySelectorAll(".dropdown-lists__total-line")[i];o.addCountryListeners(d,i)})):t.length>0?t.forEach((function(t,e){var o="",s="",n="",c="",l=t.name.toLowerCase().indexOf(i.toLowerCase()),r=t.name.toLowerCase().indexOf(i.toLowerCase().substring(i.length-1));if(0===l)o=t.name.substring(l,r+1),r<t.name.length&&(s=t.name.substring(r+1)),c="<strong>".concat(o,"</strong>").concat(s);else if(l>0){o=t.name.substring(0,l),s=i;var a=o.length+i.length;r<t.name.length&&(n=t.name.substring(a)),c="".concat(o,"<strong>").concat(s,"</strong>").concat(n)}var d='<div class="dropdown-lists__countryBlock">\n                                <div class="dropdown-lists__line" data-url="'.concat(t.link,'">\n                                <div class="dropdown-lists__city" data-url="').concat(t.link,'">').concat(c,'</div>\n                                <div class="dropdown-lists__count" data-url="').concat(t.link,'">').concat(t.count,"</div>\n                            </div>\n                        </div>");y.insertAdjacentHTML("beforeend",d)})):y.insertAdjacentHTML("beforeend",'<div class="dropdown-lists__countryBlock">\n                        <div class="dropdown-lists__line">\n                            <div class="dropdown-lists__city">Ничего не найдено</div>\n                            <div class="dropdown-lists__count"></div>'),y.querySelectorAll(".dropdown-lists__line").forEach((function(t){t.addEventListener("click",(function(t){var e=t.target.textContent.trim();"dropdown-lists__city"!==t.target.className&&(e=t.target.closest(".dropdown-lists__line").querySelector(".dropdown-lists__city").textContent.trim()),s.value=e,l.href=t.target.dataset.url,l.disabled=!1,c.style.display="none",n.style.display="block"}))}))}},{key:"addCountryListeners",value:function(t,e){var i=this;t.addEventListener("click",(function(t){var o=t.target.textContent;"dropdown-lists__country"!==t.target.className&&(o=t.target.closest(".dropdown-lists__total-line").querySelector(".dropdown-lists__country").textContent),s.value=o,c.style.display="none",n.style.display="block",i.cityOutputMode="select",i.cityClickedIndex=e,i.getCityBD(i.cityOutputMode,i.cityClickedIndex,"",i.local)}))}},{key:"createLocal",value:function(){var t,e=("local",(t=document.cookie.match(new RegExp("(?:^|; )"+"local".replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(t[1]):void 0);if(e)this.local=e;else{var i=prompt("Введите локаль (RU, EN, DE)","RU");["RU","EN","DE"].includes(i.toUpperCase())||(i="RU");var o=new Date,s=new Date("December 31, "+o.getFullYear());document.cookie="local="+encodeURIComponent(i)+"; expires="+s+"; secure",this.local=i}}},{key:"eventsListeners",value:function(){var t=this;s.addEventListener("click",(function(){t.getCityBD("default","","",t.local)})),s.addEventListener("input",(function(i){var o=i.target.value.trim().toLowerCase();t.cityOutputMode="autocomplete",t.cityClickedIndex=void 0,o.length>0?t.getCityBD(t.cityOutputMode,void 0,o,t.local):(e(),t.cityOutputMode="default",t.getCityBD(t.cityOutputMode,"","",t.local))})),n.addEventListener("click",(function(i){s.value="",c.style.display="block",n.style.display="none",l.href="#",l.disabled=!0,e(),t.cityOutputMode="default",t.getCityBD(t.cityOutputMode,"","",t.local)}))}}])&&o(p.prototype,f),y}());s.value="",l.disabled=!0,y.createLocal(),y.eventsListeners()})();